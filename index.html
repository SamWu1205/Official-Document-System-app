<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>公文發文系統 (專業版)</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { background-color: #f8fafc; font-family: system-ui, -apple-system, sans-serif; }
    
    /* 側邊欄動畫 */
    .sidebar { transition: transform 0.3s ease-in-out; }
    .sidebar-closed { transform: translateX(-100%); }
    .sidebar-open { transform: translateX(0); }
    
    /* 隱藏 Scrollbar 但保持滑動 */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* 淡入動畫 */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.2s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react">
    // ======================
    // 1. Firebase Config
    // ======================
    const firebaseConfig = {
      apiKey: "AIzaSyAHLUkaGRW7j7ZHFaTEJMKNbkMzZm218w4",
      authDomain: "official-document-system-239ab.firebaseapp.com",
      projectId: "official-document-system-239ab",
      storageBucket: "official-document-system-239ab.firebasestorage.app",
      messagingSenderId: "285835980582",
      appId: "1:285835980582:web:feb116841184884f685be7",
      measurementId: "G-B9R46YLGXQ",
    };

    const CURRENT_APP_ID = "dispatch-system-user-v2"; // 升級 v2 避免資料衝突

    try { firebase.initializeApp(firebaseConfig); } 
    catch (e) { console.warn("Firebase initialized already"); }

    const auth = firebase.auth();
    const db = firebase.firestore();

    const { useState, useEffect, useMemo, useRef } = React;

    // ======================
    // 2. 主程式
    // ======================
    function App() {
      // --- State: 使用者與資料 ---
      const [user, setUser] = useState(null);
      const [records, setRecords] = useState([]);
      const [meta, setMeta] = useState({ authors: [], codes: [], authorDefaults: {} });
      const [loading, setLoading] = useState(true);
      const [processing, setProcessing] = useState(false);

      // --- State: UI 控制 ---
      const [menuOpen, setMenuOpen] = useState(false);
      const [filter, setFilter] = useState({ type: 'all', value: '' }); // all, author, code, search
      const [sortDesc, setSortDesc] = useState(true); // true: 新到舊, false: 舊到新

      // --- State: 表單 ---
      const [form, setForm] = useState({
        id: null,
        date: new Date().toISOString().split("T")[0],
        author: "",
        code: "",
        number: "",
        subject: "",
      });

      // --- 1. 初始化與監聽 ---
      useEffect(() => {
        auth.signInAnonymously().catch(e => alert("登入失敗: " + e.message));
        return auth.onAuthStateChanged(u => setUser(u));
      }, []);

      useEffect(() => {
        if (!user) return;
        
        // (A) 監聽公文紀錄
        const recordsRef = db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid).collection("records");
        const unsubRecords = recordsRef.orderBy("createdAt", "desc").onSnapshot(snap => {
          const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
          setRecords(data);
          setLoading(false);
        });

        // (B) 監聽設定檔 (發文者/代字清單)
        const metaRef = db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid).collection("metadata").doc("general");
        const unsubMeta = metaRef.onSnapshot(doc => {
          if (doc.exists) {
            setMeta(doc.data());
          } else {
            // 初始化預設值
            setMeta({ authors: [], codes: [], authorDefaults: {} });
          }
        });

        return () => { unsubRecords(); unsubMeta(); };
      }, [user]);

      // --- 2. 邏輯處理函式 ---

      // 產生字號
      const generateNextNumber = () => {
        const today = new Date();
        const rocYear = today.getFullYear() - 1911;
        const prefix = String(rocYear); // e.g., 114
        
        // 找出所有符合今年開頭的字號
        const currentNums = records
          .map(r => r.number)
          .filter(n => n && String(n).startsWith(prefix))
          .map(n => parseInt(n, 10))
          .filter(n => !Number.isNaN(n));

        if (currentNums.length === 0) return prefix + "0000001";
        return String(Math.max(...currentNums) + 1);
      };

      // 智慧連動：選發文者自動帶入代字
      const handleAuthorChange = (val) => {
        setForm(prev => {
          const updates = { ...prev, author: val };
          // 如果有設定預設代字，且目前代字是空的，就自動帶入
          if (meta.authorDefaults && meta.authorDefaults[val] && !prev.code) {
            updates.code = meta.authorDefaults[val];
          }
          return updates;
        });
      };

      // 儲存邏輯 (新增/修改)
      const handleSave = async () => {
        if (!user) return;
        if (!form.date || !form.author || !form.code || !form.subject) {
          alert("請填寫完整資訊：日期、發文者、文電代字、主旨");
          return;
        }

        setProcessing(true);
        try {
          const userRef = db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid);
          
          // 1. 處理字號
          let finalNumber = form.number;
          if (!finalNumber) finalNumber = generateNextNumber();

          const payload = {
            date: form.date,
            author: form.author,
            code: form.code,
            number: finalNumber,
            subject: form.subject,
            updatedAt: new Date().toISOString(),
          };

          if (!form.id) {
            payload.createdAt = new Date().toISOString(); // 新增時才加
          }

          // 2. 寫入紀錄
          if (form.id) {
            await userRef.collection("records").doc(form.id).set(payload, { merge: true });
            alert("✅ 修改成功");
          } else {
            await userRef.collection("records").add(payload);
            alert(`✅ 登錄成功！字號：${finalNumber}`);
          }

          // 3. 自動更新 Metadata (若有新的人名或代字)
          const newMeta = { ...meta };
          let metaChanged = false;
          if (!newMeta.authors.includes(form.author)) {
            newMeta.authors.push(form.author);
            metaChanged = true;
          }
          if (!newMeta.codes.includes(form.code)) {
            newMeta.codes.push(form.code);
            metaChanged = true;
          }
          if (metaChanged) {
             await userRef.collection("metadata").doc("general").set(newMeta, { merge: true });
          }

          // 4. 重置表單 (保留日期)
          setForm(prev => ({ ...prev, id: null, number: "", subject: "" }));

        } catch (e) {
          console.error(e);
          alert("儲存失敗：" + e.message);
        } finally {
          setProcessing(false);
        }
      };

      // 查詢邏輯
      const handleSearch = () => {
        // 簡單實作：設定過濾器為 "search"，並將關鍵字設為當前主旨或字號
        const keyword = form.subject || form.number || form.date;
        if (!keyword) {
            setFilter({ type: 'all', value: '' });
            alert("已顯示全部資料");
            return;
        }
        setFilter({ type: 'search', value: keyword });
        alert(`已篩選包含「${keyword}」的紀錄`);
      };

      // 刪除紀錄
      const handleDeleteRecord = async (id) => {
        if (!confirm("確定刪除此筆紀錄？")) return;
        await db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid).collection("records").doc(id).delete();
        if (form.id === id) setForm(prev => ({ ...prev, id: null, number: "", subject: "" }));
      };

      // 複製到剪貼簿
      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text).then(() => {
            // 簡單提示
            const toast = document.createElement("div");
            toast.innerText = "已複製！";
            toast.style = "position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:8px 16px;border-radius:20px;font-size:12px;z-index:9999;";
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 1500);
        });
      };

      // --- 3. 側邊欄管理功能 ---
      
      const deleteMetaItem = async (type, value) => {
        if(!confirm(`確定從選單中刪除「${value}」嗎？(不會刪除歷史公文)`)) return;
        const userRef = db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid);
        const newMeta = { ...meta };
        if (type === 'author') newMeta.authors = newMeta.authors.filter(x => x !== value);
        if (type === 'code') newMeta.codes = newMeta.codes.filter(x => x !== value);
        
        await userRef.collection("metadata").doc("general").set(newMeta);
      };

      const setAuthorDefaultCode = async (authorName) => {
        const code = prompt(`請輸入「${authorName}」的預設文電代字：`, meta.authorDefaults?.[authorName] || "");
        if (code === null) return; // 取消
        
        const userRef = db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid);
        const newDefaults = { ...meta.authorDefaults, [authorName]: code };
        await userRef.collection("metadata").doc("general").set({ authorDefaults: newDefaults }, { merge: true });
      };

      // --- 4. 顯示資料計算 ---
      const displayRecords = useMemo(() => {
        let result = [...records];
        
        // 過濾
        if (filter.type === 'author') {
            result = result.filter(r => r.author === filter.value);
        } else if (filter.type === 'code') {
            result = result.filter(r => r.code === filter.value);
        } else if (filter.type === 'search') {
            const k = filter.value.toLowerCase();
            result = result.filter(r => 
                (r.subject && r.subject.includes(k)) || 
                (r.number && String(r.number).includes(k)) ||
                (r.date && r.date.includes(k))
            );
        }

        // 排序
        result.sort((a, b) => {
            // 先比日期
            const dateA = new Date(a.date).getTime();
            const dateB = new Date(b.date).getTime();
            if (dateA !== dateB) return sortDesc ? dateB - dateA : dateA - dateB;
            // 再比字號
            const numA = parseInt(a.number) || 0;
            const numB = parseInt(b.number) || 0;
            return sortDesc ? numB - numA : numA - numB;
        });

        return result;
      }, [records, filter, sortDesc]);


      // ======================
      // 3. UI Render
      // ======================
      if (!user && loading) return <div className="min-h-screen flex items-center justify-center text-slate-500">系統載入中...</div>;

      return (
        <div className="relative min-h-screen bg-slate-100 overflow-hidden flex flex-col">
            
            {/* 黑色遮罩 (當側邊欄打開時) */}
            {menuOpen && (
                <div 
                    className="absolute inset-0 bg-black/50 z-20 transition-opacity"
                    onClick={() => setMenuOpen(false)}
                ></div>
            )}

            {/* Side Menu (側邊欄) */}
            <div className={`fixed top-0 left-0 bottom-0 w-64 bg-white z-30 shadow-2xl sidebar flex flex-col ${menuOpen ? 'sidebar-open' : 'sidebar-closed'}`}>
                <div className="p-4 bg-blue-800 text-white font-bold flex justify-between items-center">
                    <span>選單與設定</span>
                    <button onClick={() => setMenuOpen(false)}><i className="fas fa-times"></i></button>
                </div>
                
                <div className="flex-1 overflow-y-auto p-4 space-y-6">
                    {/* 篩選重置 */}
                    <div>
                        <button 
                            onClick={() => { setFilter({type:'all'}); setMenuOpen(false); }}
                            className="w-full py-2 bg-slate-100 rounded text-slate-700 font-bold hover:bg-slate-200"
                        >
                            顯示所有紀錄
                        </button>
                    </div>

                    {/* 發文者管理 */}
                    <div>
                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">發文者 (篩選/設定)</h3>
                        <div className="space-y-1">
                            {meta.authors.map(a => (
                                <div key={a} className="flex items-center justify-between group text-sm">
                                    <button 
                                        onClick={() => { setFilter({type:'author', value: a}); setMenuOpen(false); }}
                                        className="text-slate-700 hover:text-blue-600 truncate flex-1 text-left py-1"
                                    >
                                        <i className="fas fa-user w-5 text-slate-300"></i> {a}
                                    </button>
                                    <div className="flex gap-2">
                                        <button onClick={() => setAuthorDefaultCode(a)} className="text-slate-300 hover:text-blue-500" title="設定預設代字">
                                            <i className="fas fa-cog"></i>
                                        </button>
                                        <button onClick={() => deleteMetaItem('author', a)} className="text-slate-300 hover:text-red-500" title="刪除">
                                            <i className="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            ))}
                            {meta.authors.length === 0 && <span className="text-xs text-slate-400">尚未有發文者紀錄</span>}
                        </div>
                    </div>

                    {/* 文電代字管理 */}
                    <div>
                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">文電代字 (篩選)</h3>
                        <div className="space-y-1">
                            {meta.codes.map(c => (
                                <div key={c} className="flex items-center justify-between group text-sm">
                                    <button 
                                        onClick={() => { setFilter({type:'code', value: c}); setMenuOpen(false); }}
                                        className="text-slate-700 hover:text-blue-600 truncate flex-1 text-left py-1"
                                    >
                                        <i className="fas fa-file-alt w-5 text-slate-300"></i> {c}
                                    </button>
                                    <button onClick={() => deleteMetaItem('code', c)} className="text-slate-300 hover:text-red-500">
                                        <i className="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
                <div className="p-4 border-t text-xs text-slate-400 text-center">
                    v2.0 系統版本
                </div>
            </div>

            {/* Header */}
            <header className="bg-white border-b px-4 py-3 flex items-center justify-between shadow-sm z-10 sticky top-0">
                <div className="flex items-center gap-3">
                    <button onClick={() => setMenuOpen(true)} className="text-slate-600 text-lg p-1">
                        <i className="fas fa-bars"></i>
                    </button>
                    <div>
                        <h1 className="font-bold text-lg text-slate-800">公文發文系統</h1>
                        {filter.type !== 'all' && (
                            <div className="text-[10px] text-blue-600 font-bold bg-blue-50 px-1 rounded inline-block">
                                正在篩選: {filter.value}
                            </div>
                        )}
                    </div>
                </div>
                <div className="flex items-center gap-2">
                     <button 
                        onClick={() => {
                            setForm({id:null, date: new Date().toISOString().split("T")[0], author:"", code:"", number:"", subject:""});
                        }}
                        className="text-blue-600 text-sm font-medium"
                    >
                        <i className="fas fa-plus-circle"></i> 新增
                    </button>
                </div>
            </header>

            {/* Main Content */}
            <main className="flex-1 overflow-y-auto bg-slate-100 pb-10">
                
                {/* 輸入區塊 (Card) */}
                <div className="bg-white m-3 p-4 rounded-xl shadow-sm space-y-4 border border-slate-200">
                    
                    {/* 第一列：日期 & 發文者 */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1">
                            <label className="text-xs font-bold text-slate-500">發文日期</label>
                            <div className="relative">
                                <input 
                                    type="date" 
                                    className="w-full bg-slate-50 border border-slate-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                    value={form.date}
                                    onChange={e => setForm({...form, date: e.target.value})}
                                />
                            </div>
                        </div>
                        <div className="space-y-1">
                            <label className="text-xs font-bold text-slate-500">發文者</label>
                            <div className="relative">
                                <input 
                                    list="author-list"
                                    type="text" 
                                    className="w-full bg-slate-50 border border-slate-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                    placeholder="選擇或輸入"
                                    value={form.author}
                                    onChange={e => handleAuthorChange(e.target.value)}
                                />
                                <datalist id="author-list">
                                    {meta.authors.map(a => <option key={a} value={a} />)}
                                </datalist>
                                <i className="fas fa-caret-down absolute right-3 top-3 text-slate-400 pointer-events-none"></i>
                            </div>
                        </div>
                    </div>

                    {/* 第二列：文電代字 & 字號 */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1">
                            <label className="text-xs font-bold text-slate-500">文電代字</label>
                            <div className="relative">
                                <input 
                                    list="code-list"
                                    type="text" 
                                    className="w-full bg-slate-50 border border-slate-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                    placeholder="選擇或輸入"
                                    value={form.code}
                                    onChange={e => setForm({...form, code: e.target.value})}
                                />
                                <datalist id="code-list">
                                    {meta.codes.map(c => <option key={c} value={c} />)}
                                </datalist>
                                <i className="fas fa-caret-down absolute right-3 top-3 text-slate-400 pointer-events-none"></i>
                            </div>
                        </div>
                        <div className="space-y-1">
                            <label className="text-xs font-bold text-slate-500 flex justify-between">
                                字號 <span className="text-[10px] font-normal text-slate-400">留空自動產生</span>
                            </label>
                            <input 
                                type="text" 
                                className="w-full bg-slate-50 border border-slate-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                placeholder="自動流水號"
                                value={form.number}
                                onChange={e => setForm({...form, number: e.target.value})}
                            />
                        </div>
                    </div>

                    {/* 第三列：主旨 */}
                    <div className="space-y-1">
                         <label className="text-xs font-bold text-slate-500">主旨</label>
                         <textarea 
                            rows="2"
                            className="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none"
                            placeholder="輸入公文主旨..."
                            value={form.subject}
                            onChange={e => setForm({...form, subject: e.target.value})}
                         ></textarea>
                    </div>

                    {/* 操作按鈕群 (依據草圖設計) */}
                    <div className="grid grid-cols-3 gap-2 pt-2">
                        <button 
                            onClick={handleSearch}
                            className="flex items-center justify-center gap-1 border border-slate-300 bg-white text-slate-700 rounded-lg py-2 text-sm font-bold active:scale-95 transition-transform"
                        >
                            <i className="fas fa-search"></i> 查詢
                        </button>
                        
                        {/* 只有在有 ID 時，更改按鈕才有效，否則 disable */}
                        <button 
                            onClick={handleSave}
                            disabled={!form.id}
                            className={`flex items-center justify-center gap-1 border border-slate-300 bg-white rounded-lg py-2 text-sm font-bold transition-transform ${form.id ? 'text-slate-700 active:scale-95' : 'text-slate-300 cursor-not-allowed'}`}
                        >
                            <i className="fas fa-pen"></i> 更改
                        </button>

                        <button 
                            onClick={() => {
                                // 強制清除 ID 視為新登錄
                                const tempForm = {...form, id: null}; 
                                // 若原本是編輯狀態，需確保 handleSubmit 會處理為新的一筆
                                // 這裡直接呼叫 save，但要先確保邏輯是針對「登錄」
                                if(form.id) {
                                    setForm(prev => ({...prev, id: null}));
                                    // 這裡用一個 timeout 讓 state 更新後再存，或者簡單 alert 提示使用者先按一下「新增」清空 ID
                                    // 為了符合直覺：點「登錄」就是要把當前內容存成新的一筆，不管有沒有 ID
                                    // 我們修改 handleSave 內部邏輯讀取的是 state，所以這裡有點 tricky。
                                    // 最簡單作法：複製一份當前資料，設 id 為 null，直接呼叫 API
                                    // 但為了保持簡單，這裡我們就執行 handleSave，但如果現在有 ID，要先問一下
                                    if(confirm("要將目前的修改另存為一筆新公文嗎？")) {
                                         // 比較複雜，暫時維持標準：有 ID 只能更改，無 ID 才能登錄
                                         // 或是按下登錄強制把 ID 拿掉再 Save
                                    }
                                } else {
                                    handleSave();
                                }
                            }}
                             // 這裡簡化邏輯：如果是在編輯模式(有ID)，按登錄 = 另存新檔；如果沒ID = 新增
                            onClick={async () => {
                                if(form.id) {
                                    // 這是另存新檔的邏輯
                                    const payload = {
                                        ...form,
                                        id: null,
                                        number: generateNextNumber() // 另存一定要新字號
                                    };
                                    // 手動呼叫 db
                                    const userRef = db.collection("artifacts").doc(CURRENT_APP_ID).collection("users").doc(user.uid);
                                    await userRef.collection("records").add({
                                        ...payload,
                                        updatedAt: new Date().toISOString(),
                                        createdAt: new Date().toISOString()
                                    });
                                    alert(`已另存為新公文，字號：${payload.number}`);
                                    setForm({id:null, date: new Date().toISOString().split("T")[0], author:"", code:"", number:"", subject:""});
                                } else {
                                    handleSave();
                                }
                            }}
                            className="flex items-center justify-center gap-1 bg-slate-800 text-white rounded-lg py-2 text-sm font-bold active:scale-95 transition-transform"
                        >
                            <i className="fas fa-file-export"></i> 登錄
                        </button>
                    </div>

                    {/* 快速分類標籤 (裝飾用，可擴充) */}
                    <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                        <span className="px-3 py-1 bg-blue-50 text-blue-600 text-xs rounded-full font-bold whitespace-nowrap">一般公文</span>
                        <span className="px-3 py-1 bg-slate-100 text-slate-500 text-xs rounded-full whitespace-nowrap">獎懲</span>
                        <span className="px-3 py-1 bg-slate-100 text-slate-500 text-xs rounded-full whitespace-nowrap">調職(晉升)</span>
                    </div>

                </div>

                {/* 列表標題與排序 */}
                <div className="px-4 flex items-center justify-between mt-6 mb-2">
                    <div className="text-sm font-bold text-slate-700">發文紀錄</div>
                    <button 
                        onClick={() => setSortDesc(!sortDesc)}
                        className="text-xs bg-white border px-2 py-1 rounded text-slate-500 flex items-center gap-1"
                    >
                        排序: {sortDesc ? "由新到舊" : "由舊到新"} <i className={`fas fa-sort-${sortDesc ? 'amount-down' : 'amount-up'}`}></i>
                    </button>
                </div>

                {/* 列表內容 */}
                <div className="space-y-3 px-3">
                    {displayRecords.length === 0 && (
                        <div className="text-center py-10 text-slate-400 text-sm">
                            沒有符合的資料
                        </div>
                    )}
                    
                    {displayRecords.map(r => (
                        <div 
                            key={r.id}
                            onClick={() => {
                                setForm({
                                    id: r.id,
                                    date: r.date,
                                    author: r.author,
                                    code: r.code,
                                    number: r.number,
                                    subject: r.subject
                                });
                                window.scrollTo({ top: 0, behavior: "smooth" });
                            }}
                            className="bg-white border border-slate-200 rounded-lg p-3 shadow-sm active:bg-blue-50 transition-colors relative"
                        >
                            {/* 表頭資訊 */}
                            <div className="flex justify-between items-start mb-1">
                                <div className="flex gap-2 text-[11px] text-slate-500 font-mono">
                                    <span>{r.date}</span>
                                    <span>|</span>
                                    <span>{r.code}</span>
                                    <span>|</span>
                                    <span className="text-blue-600 font-bold">{r.number}</span>
                                </div>
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        // 複製格式：日期 文電代字 字號 主旨
                                        const text = `${r.date} ${r.code} ${r.number} ${r.subject}`;
                                        copyToClipboard(text);
                                    }}
                                    className="text-slate-400 hover:text-blue-600 p-1"
                                >
                                    <i className="far fa-copy"></i>
                                </button>
                            </div>
                            
                            {/* 主旨 */}
                            <div className="text-sm text-slate-800 font-medium leading-relaxed pr-8">
                                {r.subject}
                            </div>
                            
                            {/* 作者與刪除 */}
                            <div className="flex justify-between items-center mt-2 border-t pt-2 border-slate-100">
                                <span className="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full">
                                    <i className="fas fa-user-circle mr-1"></i>{r.author}
                                </span>
                                <button 
                                    onClick={(e) => { e.stopPropagation(); handleDeleteRecord(r.id); }}
                                    className="text-xs text-red-300 hover:text-red-500 px-2 py-1"
                                >
                                    刪除
                                </button>
                            </div>
                        </div>
                    ))}
                </div>

            </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>